---
# Ansible scripts for configuring a DAOS node with ftest

- name: Gather distribution specific variables
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ playbook_dir }}/vars/{{ ansible_distribution }}{{ ansible_distribution_major_version}}.yml"

- name: Set includedir in sudoers
  remote_user: root
  lineinfile:
    state: present
    create: no
    dest: /etc/sudoers
    line: "#includedir /etc/sudoers.d"
    validate: /usr/sbin/visudo -cf %s

- name: "Add user {{ ansible_user_id }} to sudo"
  remote_user: root
  lineinfile:
    state: present
    create: yes
    owner: root
    group: root
    path: "/etc/sudoers.d/{{ ansible_user_id }}"
    line: "{{ ansible_user_id}} ALL=(ALL) NOPASSWD: ALL"
    mode: 0440
    validate: /usr/sbin/visudo -cf %s
